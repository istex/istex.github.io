
'use strict';;(function($,window,document,undefined){var pluginName="istexFacets";var defaults=istexConfigDefault;function Plugin(element,options){this.elt=element;this.settings=$.extend({},defaults,istexConfig,options);this._defaults=defaults;this._name=pluginName;this.selectedCorpus=[];this.init();}
Plugin.prototype.init=function(){var self=this;$(document).bind(self.settings.resultsEventName,function(event,results,istexSearch){self.updateFacetsInTheDom(results,istexSearch);});$(document).bind(self.settings.waitingForResultsEventName,function(event){$(self.elt).css({opacity:0.5});});$(document).bind(self.settings.newSearchEventName,function(event){self.selectedCorpus=[];});};Plugin.prototype.updateFacetsInTheDom=function(results,istexSearch){var self=this;if(!results){$(self.elt).empty();return;}
var facets=$('<div class="istex-facets">'+'<h3 class="istex-facets-title">'+self.settings.labels.facets.title+'</h3>'+'</div>').hide();var facetCorpus=self.getCorpusFacetDom(results,istexSearch);if(facetCorpus){facets.append(facetCorpus);}
$(self.elt).empty();$(self.elt).css({opacity:1.0});$(self.elt).append(facets);facets.fadeIn();};Plugin.prototype.getCorpusFacetDom=function(results,istexSearch){var self=this;if(!results||!results.aggregations||!results.aggregations.corpus||!results.aggregations.corpus.buckets){return null;}
var facetCorpus=$('<div class="istex-facet">'+'<h4 class="istex-facet-name">'+self.settings.labels.facets.corpus+'</h4>'+'<ul class="istex-facet-corpus"></ul>'+'</div>');results.aggregations.corpus.buckets.forEach(function(corpus){var corpusCheckbox=$('<li>'+'<label>'+'<input type="checkbox" value="'+corpus.key+'" />'+
corpus.key+'<span class="istex-facet-corpus-badge">'+corpus.doc_count+'</span>'+'</label>'+'</li>');if(self.selectedCorpus.indexOf(corpus.key)!==-1){corpusCheckbox.find('input').attr('checked','checked');}else{corpusCheckbox.find('input').removeAttr('checked');}
facetCorpus.find('ul.istex-facet-corpus').append(corpusCheckbox);});facetCorpus.find('.istex-facet-corpus input').click(function(){var clickedCorpus=$(this).val();self.toggleCorpusFacet(clickedCorpus);istexSearch.execQuery({corpus:self.selectedCorpus.join(',')});});return facetCorpus;};Plugin.prototype.toggleCorpusFacet=function(corpus){var self=this;var corpusIdx=self.selectedCorpus.indexOf(corpus);if(corpusIdx!==-1){self.selectedCorpus.splice(corpusIdx,1);}else{self.selectedCorpus.push(corpus);}};$.fn[pluginName]=function(options){this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options));}});return this;};})(jQuery,window,document);