
'use strict';;(function($,window,document,undefined){var pluginName="istexSearch";var defaults=istexConfigDefault;function Plugin(element,options){this.elt=element;this.settings=$.extend({},defaults,istexConfig,options);this._defaults=defaults;this._name=pluginName;this.init();}
Plugin.prototype.init=function(){var self=this;self.checkIsAuthWithCookie(function(err){self.loadInputForm();});};Plugin.prototype.loadInputForm=function(){var self=this;$(self.elt).empty();$(self.elt).append('<form class="istex-search-form">'+'<div class="istex-search-bar-wrapper">'+'<input class="istex-search-submit" type="submit" value="Rechercher" />'+'<span>'+'<input class="istex-search-input" type="text" value="" placeholder="Votre requÃªte ici ..." />'+'</span>'+'</div>'+'<p class="istex-search-error">error</p>'+'</form>');$(self.elt).find('.istex-search-input').val(self.settings.query);$(self.elt).find('.istex-search-form').submit(function(){var query=$(self.elt).find('input.istex-search-input').val().trim();query=query?query:'*';$.jsonp({url:self.settings.istexApi+'/document/',data:{q:query,output:'*'},callbackParameter:"callback",success:function(items){$(self.elt).find('.istex-search-error').hide();$.event.trigger(self.settings.resultsEventName,[items,self]);},error:function(opt,err){$(self.elt).find('.istex-search-error').html('<a href="https://api.istex.fr/corpus/">API Istex</a> non joignable.');$(self.elt).find('.istex-search-error').show();}});return false;});if(self.settings.query){$(self.elt).find('.istex-search-form').trigger('submit');}};Plugin.prototype.checkIsAuthWithCookie=function(cb){var self=this;var authPopup=null;function insertConnectButtonIfNotExists(){if($(self.elt).find('.istex-ezproxy-auth-btn').length>0)return;$(self.elt).append('<button class="istex-ezproxy-auth-btn">Se connecter<div></div></button>');$(self.elt).find('.istex-ezproxy-auth-btn').click(function(){authPopup=window.open(self.settings.istexApi+'/corpus/');});}
function authChecker(){$.jsonp({url:self.settings.istexApi+'/corpus/',callbackParameter:"callback",success:function(corpus){if(authPopup)authPopup.close();cb(null);},error:function(opt,err){insertConnectButtonIfNotExists();setTimeout(authChecker,100);}});};authChecker();};$.fn[pluginName]=function(options){this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options));}});return this;};})(jQuery,window,document);